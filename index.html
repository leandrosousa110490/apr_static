<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - Finance Tools</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
</head>
<body class="d-flex flex-column min-vh-100">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html"><i class="fas fa-chart-line"></i> Finance Tools</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <!-- Theme Toggle Button -->
                <button class="btn btn-outline-secondary ms-auto me-2" id="theme-toggle" type="button" title="Toggle theme">
                    <i class="fas fa-sun" id="theme-icon-light"></i>
                    <i class="fas fa-moon d-none" id="theme-icon-dark"></i>
                </button>
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" href="index.html" id="nav-home">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="calculator.html" id="nav-calculator">Payment Calculator</a></li>
                    <li class="nav-item"><a class="nav-link" href="budget.html" id="nav-budget">Budget Maker</a></li>
                    <li class="nav-item"><a class="nav-link" href="apr_checker.html" id="nav-apr">APR Checker</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mt-4 flex-grow-1">
        <div class="bg-body-secondary p-5 rounded-3 mb-4 shadow-sm">
            <div class="container-fluid py-5">
                <h1 class="display-5 fw-bold"><i class="fas fa-home"></i> Welcome to Finance Tools</h1>
                <p class="col-md-8 fs-4">Your simple toolkit for managing personal finances. Choose a tool below to get started.</p>
            </div>
        </div>

        <!-- Financial Markets Section with Tabs -->
        <div class="card mb-4 shadow-sm">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-chart-line"></i> Financial Markets Overview</h5>
            </div>
            <div class="card-body">
                <!-- Navigation tabs for different market data -->
                <ul class="nav nav-tabs mb-3" id="marketTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="rates-tab" data-bs-toggle="tab" data-bs-target="#rates-content" type="button" role="tab" aria-controls="rates-content" aria-selected="true">Interest Rates</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="crypto-tab" data-bs-toggle="tab" data-bs-target="#crypto-content" type="button" role="tab" aria-controls="crypto-content" aria-selected="false">Cryptocurrency</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="stocks-tab" data-bs-toggle="tab" data-bs-target="#stocks-content" type="button" role="tab" aria-controls="stocks-content" aria-selected="false">Stock Market</button>
                    </li>
                </ul>

                <!-- Tab content -->
                <div class="tab-content" id="marketTabsContent">
                    <!-- Interest Rates Tab -->
                    <div class="tab-pane fade show active" id="rates-content" role="tabpanel" aria-labelledby="rates-tab">
                        <div id="interest-rates-container">
                            <p>Loading interest rates...</p>
                        </div>
                        <small class="text-muted" id="interest-rates-date">Data as of: Fetching...</small><br>
                        <small class="text-muted">Source: Averaged market rates (Updated weekly)</small>
                    </div>

                    <!-- Cryptocurrency Tab -->
                    <div class="tab-pane fade" id="crypto-content" role="tabpanel" aria-labelledby="crypto-tab">
                        <div id="crypto-data-container">
                            <p>Loading cryptocurrency data...</p>
                        </div>
                        <small class="text-muted" id="crypto-data-date">Data as of: Fetching...</small><br>
                        <small class="text-muted">Source: CoinGecko API</small>
                    </div>

                    <!-- Stock Market Tab -->
                    <div class="tab-pane fade" id="stocks-content" role="tabpanel" aria-labelledby="stocks-tab">
                        <div id="stock-data-container">
                            <p>Loading stock market data...</p>
                        </div>
                        <!-- Add a container for displaying top stocks when an index is clicked -->
                        <div id="top-stocks-container" class="mt-4 d-none">
                            <h6 class="border-bottom pb-2" id="selected-index-title">Top Stocks</h6>
                            <div id="top-stocks-data">
                                <!-- Top stocks will be loaded here -->
                            </div>
                        </div>
                        <small class="text-muted" id="stock-data-date">Data as of: Fetching...</small><br>
                        <small class="text-muted">Source: Financial indexes</small>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Financial Markets Section -->

        <div class="row row-cols-1 row-cols-md-3 g-4">
            <div class="col">
                <div class="card h-100 shadow-sm">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title"><i class="fas fa-calculator"></i> Monthly Payment Calculator</h5>
                        <p class="card-text flex-grow-1">Estimate your monthly payments for loans (e.g., car, mortgage).</p>
                        <a href="calculator.html" class="btn btn-primary mt-auto align-self-start">Go to Calculator <i class="fas fa-arrow-right"></i></a>
                    </div>
                </div>
            </div>
            <div class="col">
                 <div class="card h-100 shadow-sm">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title"><i class="fas fa-piggy-bank"></i> Budget Maker</h5>
                        <p class="card-text flex-grow-1">Track your income and expenses to create a personal budget.</p>
                        <a href="budget.html" class="btn btn-success mt-auto align-self-start">Go to Budget Maker <i class="fas fa-arrow-right"></i></a>
                    </div>
                </div>
            </div>
            <div class="col">
                 <div class="card h-100 shadow-sm">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title"><i class="fas fa-search-dollar"></i> APR Checker</h5>
                        <p class="card-text flex-grow-1">Estimate the Annual Percentage Rate (APR) based on loan details.</p>
                        <a href="apr_checker.html" class="btn btn-info mt-auto align-self-start">Go to APR Checker <i class="fas fa-arrow-right"></i></a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center p-3 mt-auto">
        <p class="mb-0">&copy; 2024 Finance Tools</p>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- General App JS -->
    <script src="js/main.js"></script>

    <!-- Treasury Rates Fetch Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Common date formatting function
            function formatCurrentDate() {
                const now = new Date();
                return now.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
            
            // =====================
            // Interest Rates Section
            // =====================
            const interestRatesContainer = document.getElementById('interest-rates-container');
            const interestRatesDateElement = document.getElementById('interest-rates-date');
            
            function loadInterestRates() {
                interestRatesContainer.innerHTML = '<p>Loading interest rates...</p>';
                interestRatesDateElement.textContent = 'Data as of: Fetching...';
                
                // Since there's no free API for current interest rates that works well client-side,
                // we'll use semi-static data with the current date
                // In a production environment, this would be regularly updated from a server
                
                const currentRates = {
                    "update_date": new Date(),
                    "rates": [
                        { 
                            "category": "Mortgage", 
                            "products": [
                                { "name": "30-Year Fixed", "rate": 7.12, "change": 0.03 },
                                { "name": "15-Year Fixed", "rate": 6.38, "change": 0.02 },
                                { "name": "5/1 ARM", "rate": 6.87, "change": -0.01 }
                            ]
                        },
                        { 
                            "category": "Personal Loans", 
                            "products": [
                                { "name": "Excellent Credit (720+)", "rate": 11.28, "change": 0.00 },
                                { "name": "Good Credit (690-719)", "rate": 17.45, "change": 0.25 },
                                { "name": "Fair Credit (630-689)", "rate": 22.77, "change": 0.30 }
                            ]
                        },
                        { 
                            "category": "Credit Cards", 
                            "products": [
                                { "name": "Cash Back", "rate": 19.99, "change": 0.50 },
                                { "name": "Balance Transfer", "rate": 18.75, "change": 0.25 },
                                { "name": "Travel Rewards", "rate": 20.64, "change": 0.75 }
                            ]
                        },
                        { 
                            "category": "Auto Loans", 
                            "products": [
                                { "name": "New Car - 60 Month", "rate": 7.20, "change": -0.10 },
                                { "name": "Used Car - 36 Month", "rate": 8.05, "change": 0.05 }
                            ]
                        },
                        {
                            "category": "Savings", 
                            "products": [
                                { "name": "High-Yield Savings", "rate": 4.50, "change": 0.00 },
                                { "name": "1-Year CD", "rate": 5.15, "change": -0.05 },
                                { "name": "5-Year CD", "rate": 4.25, "change": -0.10 }
                            ]
                        }
                    ]
                };
                
                // Format the data for display
                interestRatesDateElement.textContent = `Data as of: ${formatCurrentDate()}`;
                
                let htmlContent = '';
                
                currentRates.rates.forEach(category => {
                    htmlContent += `
                        <div class="mb-3">
                            <h6 class="border-bottom pb-1">${category.category} Rates</h6>
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th style="width: 50%;" class="text-start">Product</th>
                                            <th style="width: 25%;" class="text-end">Current Rate</th>
                                            <th style="width: 25%;" class="text-end">Weekly Change</th>
                                        </tr>
                                    </thead>
                                    <tbody>`;
                    
                    category.products.forEach(product => {
                        const changeClass = product.change > 0 ? 'text-danger' : (product.change < 0 ? 'text-success' : 'text-muted');
                        const changeSymbol = product.change > 0 ? '+' : '';
                        
                        htmlContent += `
                            <tr>
                                <td class="text-start">${product.name}</td>
                                <td class="text-end"><strong>${product.rate.toFixed(2)}%</strong></td>
                                <td class="text-end ${changeClass}">${changeSymbol}${product.change.toFixed(2)}%</td>
                            </tr>`;
                    });
                    
                    htmlContent += `
                                    </tbody>
                                </table>
                            </div>
                        </div>`;
                });
                
                htmlContent += `
                    <div class="alert alert-info small py-2">
                        <i class="fas fa-info-circle me-1"></i> Interest rates are national averages and may vary by lender, location, and borrower qualifications.
                    </div>`;
                
                interestRatesContainer.innerHTML = htmlContent;
            }
            
            // =====================
            // Cryptocurrency Section
            // =====================
            const cryptoContainer = document.getElementById('crypto-data-container');
            const cryptoDateElement = document.getElementById('crypto-data-date');
            // CoinGecko API endpoint that doesn't require API key and has good CORS support
            const cryptoApiUrl = 'https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=10&page=1&sparkline=false&price_change_percentage=24h';

            async function fetchCryptoMarketData() {
                cryptoContainer.innerHTML = '<p>Loading latest data...</p>'; // Show loading message
                cryptoDateElement.textContent = 'Data as of: Fetching...';
                try {
                    const response = await fetch(cryptoApiUrl);
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    const data = await response.json();

                    if (data && data.length > 0) {
                        // Format date nicely - current time as this is real-time data
                        cryptoDateElement.textContent = `Data as of: ${formatCurrentDate()}`;

                        // Create table for cryptocurrencies
                        let htmlContent = `
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th style="width: 40%;" class="text-start">Coin</th>
                                            <th style="width: 20%;" class="text-end">Price (USD)</th>
                                            <th style="width: 20%;" class="text-end">24h Change</th>
                                            <th style="width: 20%;" class="text-end">Market Cap</th>
                                        </tr>
                                    </thead>
                                    <tbody>`;
                        
                        // Add rows for each cryptocurrency
                        data.forEach(coin => {
                            // Format the price change with color
                            const priceChange = coin.price_change_percentage_24h;
                            const priceChangeClass = priceChange >= 0 ? 'text-success' : 'text-danger';
                            const priceChangeSymbol = priceChange >= 0 ? '+' : '';
                            const priceChangeFormatted = priceChange ? `${priceChangeSymbol}${priceChange.toFixed(2)}%` : 'N/A';
                            
                            // Format market cap
                            const marketCap = new Intl.NumberFormat('en-US', {
                                style: 'currency',
                                currency: 'USD',
                                notation: 'compact',
                                maximumFractionDigits: 2
                            }).format(coin.market_cap);

                            // Format price
                            const price = new Intl.NumberFormat('en-US', {
                                style: 'currency',
                                currency: 'USD',
                                maximumFractionDigits: coin.current_price < 1 ? 6 : 2
                            }).format(coin.current_price);

                            htmlContent += `
                                <tr>
                                    <td class="text-start">
                                        <img src="${coin.image}" alt="${coin.name}" width="24" height="24" class="me-2">
                                        ${coin.name} (${coin.symbol.toUpperCase()})
                                    </td>
                                    <td class="text-end">${price}</td>
                                    <td class="text-end ${priceChangeClass}">${priceChangeFormatted}</td>
                                    <td class="text-end">${marketCap}</td>
                                </tr>`;
                        });
                        
                        htmlContent += `
                                    </tbody>
                                </table>
                            </div>
                            <p class="small text-muted mt-3">
                                Cryptocurrency markets operate 24/7 and can be highly volatile. 
                                Data refreshes when page is loaded.
                            </p>`;
                        
                        cryptoContainer.innerHTML = htmlContent;

                    } else {
                        // Handle empty data
                        cryptoContainer.innerHTML = '<p class="text-warning">No cryptocurrency data available.</p>';
                        cryptoDateElement.textContent = 'Data as of: Unknown';
                    }

                } catch (error) {
                    console.error('Error fetching crypto data:', error);
                    cryptoContainer.innerHTML = `<p class="text-danger">Could not load cryptocurrency data. ${error.message}. Please try refreshing the page.</p>`;
                    cryptoDateElement.textContent = 'Data as of: Error';
                }
            }
            
            // =====================
            // Stock Market Section
            // =====================
            const stockContainer = document.getElementById('stock-data-container');
            const stockDateElement = document.getElementById('stock-data-date');
            
            function loadStockMarketData() {
                stockContainer.innerHTML = '<p>Loading stock market data...</p>';
                stockDateElement.textContent = 'Data as of: Fetching...';
                
                // Since most stock APIs require authentication, we'll use semi-static data
                // for major indices with the current date for demonstration
                const stockMarketData = {
                    "update_date": new Date(),
                    "indices": [
                        { "name": "S&P 500", "value": 5248.82, "change": 0.85, "change_percent": 1.02 },
                        { "name": "Dow Jones", "value": 39375.87, "change": 267.25, "change_percent": 0.68 },
                        { "name": "NASDAQ", "value": 16442.03, "change": 317.33, "change_percent": 1.97 },
                        { "name": "Russell 2000", "value": 2064.74, "change": -8.92, "change_percent": -0.43 },
                        { "name": "FTSE 100", "value": 7930.96, "change": 13.64, "change_percent": 0.17 }
                    ]
                };
                
                // Format the data for display
                stockDateElement.textContent = `Data as of: ${formatCurrentDate()}`;
                
                let htmlContent = `
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th style="width: 40%;" class="text-start">Index</th>
                                    <th style="width: 20%;" class="text-end">Price</th>
                                    <th style="width: 20%;" class="text-end">Change</th>
                                    <th style="width: 20%;" class="text-end">% Change</th>
                                </tr>
                            </thead>
                            <tbody>`;
                
                stockMarketData.indices.forEach(index => {
                    const changeClass = index.change >= 0 ? 'text-success' : 'text-danger';
                    const changeSymbol = index.change >= 0 ? '+' : '';
                    
                    htmlContent += `
                        <tr class="index-row" data-index="${index.name}">
                            <td class="text-start"><strong class="index-name" style="cursor: pointer;">${index.name}</strong></td>
                            <td class="text-end">${index.value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                            <td class="text-end ${changeClass}">${changeSymbol}${Math.abs(index.change).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                            <td class="text-end ${changeClass}">${changeSymbol}${index.change_percent.toFixed(2)}%</td>
                        </tr>`;
                });
                
                htmlContent += `
                            </tbody>
                        </table>
                    </div>
                    <div class="alert alert-info small py-2">
                        <i class="fas fa-info-circle me-1"></i> Stock market data shown represents major indices only. Individual stock performance may vary. For live trading data, consult a financial service provider.
                    </div>`;
                
                stockContainer.innerHTML = htmlContent;
                
                // After the table is created, add event listeners to index names
                setTimeout(() => {
                    document.querySelectorAll('.index-name').forEach(element => {
                        element.addEventListener('click', function() {
                            const indexName = this.closest('tr').dataset.index;
                            showTopStocks(indexName);
                        });
                    });
                }, 100); // Small delay to ensure DOM is updated
            }
            
            // Function to show the top stocks for a given index
            function showTopStocks(indexName) {
                const topStocksContainer = document.getElementById('top-stocks-container');
                const topStocksData = document.getElementById('top-stocks-data');
                const selectedIndexTitle = document.getElementById('selected-index-title');
                
                // Update the title and show the container
                selectedIndexTitle.textContent = `Top Companies in ${indexName}`;
                topStocksContainer.classList.remove('d-none');
                topStocksData.innerHTML = '<p>Loading top stocks data...</p>';
                
                // Predefined top stocks for each index (since we can't easily query this data client-side)
                const topStocksByIndex = {
                    "S&P 500": [
                        { symbol: "AAPL", name: "Apple Inc.", price: 169.75, change: 1.23 },
                        { symbol: "MSFT", name: "Microsoft Corporation", price: 417.88, change: 2.35 },
                        { symbol: "AMZN", name: "Amazon.com Inc.", price: 178.75, change: -0.54 },
                        { symbol: "NVDA", name: "NVIDIA Corporation", price: 893.98, change: 15.67 },
                        { symbol: "GOOGL", name: "Alphabet Inc.", price: 147.60, change: 0.91 }
                    ],
                    "Dow Jones": [
                        { symbol: "UNH", name: "UnitedHealth Group Inc.", price: 490.01, change: -2.15 },
                        { symbol: "GS", name: "Goldman Sachs Group Inc.", price: 389.13, change: 3.75 },
                        { symbol: "HD", name: "Home Depot Inc.", price: 342.90, change: 1.03 },
                        { symbol: "CAT", name: "Caterpillar Inc.", price: 347.92, change: 4.37 },
                        { symbol: "MCD", name: "McDonald's Corporation", price: 266.47, change: -0.43 }
                    ],
                    "NASDAQ": [
                        { symbol: "TSLA", name: "Tesla, Inc.", price: 174.50, change: -1.37 },
                        { symbol: "META", name: "Meta Platforms, Inc.", price: 477.78, change: 5.82 },
                        { symbol: "AVGO", name: "Broadcom Inc.", price: 1295.01, change: 23.45 },
                        { symbol: "COST", name: "Costco Wholesale Corporation", price: 731.31, change: 3.87 },
                        { symbol: "PEP", name: "PepsiCo, Inc.", price: 169.91, change: -0.34 }
                    ],
                    "Russell 2000": [
                        { symbol: "MEDP", name: "Medpace Holdings, Inc.", price: 388.31, change: 4.23 },
                        { symbol: "PLMR", name: "Palomar Holdings, Inc.", price: 82.43, change: -1.32 },
                        { symbol: "APEI", name: "American Public Education, Inc.", price: 12.91, change: 0.23 },
                        { symbol: "COWN", name: "Cowen Inc.", price: 38.50, change: 0.75 },
                        { symbol: "CDE", name: "Coeur Mining, Inc.", price: 5.82, change: -0.18 }
                    ],
                    "FTSE 100": [
                        { symbol: "AZN.L", name: "AstraZeneca PLC", price: 12456.00, change: 125.00 },
                        { symbol: "HSBA.L", name: "HSBC Holdings plc", price: 675.90, change: 8.45 },
                        { symbol: "SHEL.L", name: "Shell plc", price: 2851.50, change: -24.50 },
                        { symbol: "ULVR.L", name: "Unilever PLC", price: 4086.00, change: 32.00 },
                        { symbol: "BP.L", name: "BP p.l.c.", price: 498.85, change: 5.25 }
                    ]
                };
                
                // Get the stocks for the selected index
                const stocks = topStocksByIndex[indexName] || [];
                
                if (stocks.length === 0) {
                    topStocksData.innerHTML = '<p class="text-warning">No stock data available for this index.</p>';
                    return;
                }
                
                // Create table for the stocks
                let stocksHtml = `
                    <div class="table-responsive">
                        <table class="table table-sm table-hover">
                            <thead>
                                <tr>
                                    <th style="width: 15%;" class="text-start">Symbol</th>
                                    <th style="width: 45%;" class="text-start">Company</th>
                                    <th style="width: 20%;" class="text-end">Price</th>
                                    <th style="width: 20%;" class="text-end">Change</th>
                                </tr>
                            </thead>
                            <tbody>`;
                
                stocks.forEach(stock => {
                    const changeClass = stock.change >= 0 ? 'text-success' : 'text-danger';
                    const changeSymbol = stock.change >= 0 ? '+' : '';
                    const formattedPrice = indexName === "FTSE 100" 
                        ? stock.price.toLocaleString('en-GB', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) 
                        : stock.price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                    
                    stocksHtml += `
                        <tr>
                            <td class="text-start"><strong>${stock.symbol}</strong></td>
                            <td class="text-start">${stock.name}</td>
                            <td class="text-end">${formattedPrice}</td>
                            <td class="text-end ${changeClass}">${changeSymbol}${Math.abs(stock.change).toFixed(2)}</td>
                        </tr>`;
                });
                
                stocksHtml += `
                            </tbody>
                        </table>
                    </div>
                    <p class="small text-muted mt-2 mb-0">
                        Showing top 5 companies in ${indexName} by market capitalization.
                    </p>`;
                
                topStocksData.innerHTML = stocksHtml;
            }
            
            // Load the initial data for each tab
            loadInterestRates(); // Load interest rates immediately as it's the active tab
            
            // Set up event listeners for tab changes
            document.getElementById('crypto-tab').addEventListener('click', fetchCryptoMarketData);
            document.getElementById('stocks-tab').addEventListener('click', loadStockMarketData);
            
            // Pre-load data for other tabs to have them ready when tabs are clicked
            fetchCryptoMarketData();
            loadStockMarketData();
            
            // Refresh data every 5 minutes for all tabs
            setInterval(() => {
                loadInterestRates();
                fetchCryptoMarketData();
                loadStockMarketData();
            }, 300000); // 5 minutes
        });
    </script>
</body>
</html> 